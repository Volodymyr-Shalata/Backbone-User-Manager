<html>
    <head>
        <title>Backbone application</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css">
        <link rel="stylesheet" href="css.css">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/fonts/glyphicons-halflings-regular.eot">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/fonts/glyphicons-halflings-regular.svg">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/fonts/glyphicons-halflings-regular.ttf">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/fonts/glyphicons-halflings-regular.woff">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/fonts/glyphicons-halflings-regular.woff2">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/fonts/fontawesome-webfont.eot">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/fonts/fontawesome-webfont.svg">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/fonts/fontawesome-webfont.ttf">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/fonts/fontawesome-webfont.woff">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/fonts/fontawesome-webfont.woff2">



        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-modal/2.2.5/css/bootstrap-modal.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-social/4.9.0/bootstrap-social.css">

        <script src="libs/jquery.js"></script>
        <script src="libs/underscore.js"></script>
        <script src="libs/backbone.js"></script>
        <script src="functions.js"></script>
        <script src="libs/jquery.confirm.min.js"></script>
        <script src="libs/validator.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.4/js/bootstrap-dialog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.2/js/bootstrap-select.min.js"></script>
        <script src="libs/jquery.cookie.js"></script>

    </head>
    <body>

    <script type="text/template" id="mega-menu">
        <div class="navbar navbar-inverse">
            <div class="container">
                <button class="navbar-toggle" data-toggle="collapse" data-target=".navHeaderCollapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="collapse navbar-collapse navHeaderCollapse">
                    <ul class="nav navbar-nav navbar-left">
                        <li class="active"><a href="#/home">Home</a></li>
                        <% if(menuInfo) {%>
                            <% if(menuInfo.is_logged) {%>
                                <% if(menuInfo.role == "owner" || menuInfo.role == "admin") {%>
                                    <li class="active"><a href="#/userManager" id="userManager">User Manager</a></li>
                                <% }%>
                            <%}%>
                        <% };%>

                        <li><a href="#">Blog</a></li>
                        <!--<li class="dropdown">-->
                            <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Social Media <span class="caret"></span></a>-->
                            <!--<ul class="dropdown-menu" role="menu">-->
                                <!--<li><a href="#">VK</a></li>-->
                                <!--<li><a href="#">Facebook</a></li>-->
                                <!--<li><a href="#">Linkedin</a></li>-->
                                <!--<li><a href="#">Odnoclasniki</a></li>-->
                                <!--<li><a href="#">Twitter</a></li>-->
                            <!--</ul>-->
                        <!--</li>-->
                        <li><a href="#">About</a></li>
                        <li><a href="#">Contact</a></li>

                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <% if(menuInfo && menuInfo.is_logged) {%>
                        <li><a href="#/logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                        <% }else{ %>
                        <li><a href="#/login"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                        <% };%>
                        <li><a href="#/signup"><span class="glyphicon glyphicon-user"></span>&nbspSign up</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </script>

    <div class="mega_menu">
    </div>

    <div class="container">
        <div class="page"></div>
    </div>

    <script type="text/template" id="home-page">
        <div class="margin-left-30 margin-top-30">
            <div class="text-info">
                <h1>Home Page</h1>
            </div>
            <% if(data) {%>
            <%= data.home %>
            <% if(data.userName){%>
            <div>
                You are now currently logged as <%= data.userName%>
                <br>
                Please, click to <a href="#/logout">Logout</a>
            </div>
            <% } %>
            <% };%>
        </div>
    </script>

    <script type="text/template" id="sign-up">
           <form name="sign_up" class="form-horizontal margin-top-80"  data-toggle="validator" role="form">
               <div class="form-group">
                   <label for="First Name" class="col-sm-2 control-label white-color">First Name</label>
                   <div class="col-sm-4">
                       <input type="text" data-minlength="3" class="register form-control" id="First Name" name="first_name" placeholder="First name..." required>
                   </div>
                   <div class="help-block with-errors text-info ">Minimum 3 letters</div>
               </div>
               <div class="form-group">
                   <label for="Last Name" class="col-sm-2 control-label white-color">Last Name</label>
                   <div class="col-sm-4">
                       <input type="text" class="register form-control"  id="Last Name" name="last_name" placeholder="Last Name...">
                   </div>
               </div>
               <div class="form-group">
                   <label for="Age" class="col-sm-2 control-label white-color">Age</label>
                   <div class="col-sm-4">
                       <input type="text" class="register form-control"  id="Age" name="age" placeholder="Age...">
                   </div>
               </div>
               <div class="form-group">
                   <label for="Email" class="col-sm-2 control-label white-color">Email</label>
                   <div class="col-sm-4">
                       <input type="email" class="register form-control"  id="Email" name="email" placeholder="@Email..." data-error="That email address is invalid" required>
                   </div>
                   <div class="help-block with-errors"></div>
               </div>
               <div class="form-group">
                   <label for="Password" class="col-sm-2 control-label white-color">Password</label>
                   <div class="col-sm-4">
                       <input type="password" data-minlength="6" class="register  form-control"  id="Password" name="password" placeholder="Password..." required>
                   </div>
                   <div class="help-block with-errors"></div>
               </div>
               <div class="form-group">
                   <label for="Confirm Password" class="col-sm-2 control-label white-color">Confirm Password</label>
                   <div class="col-sm-4">
                       <input type="password" class="register form-control"  id="Confirm Password" name="confirm_assword" placeholder="Confirm Password..." data-match="#Password" data-match-error="Whoops, these don't match" required>
                   </div>
                   <div class="help-block with-errors"></div>
               </div>
               <button id="register" class="btn btn-primary col-sm-offset-2" type="submit">Register</button>
           </form>
    </script>
        
    <script type="text/template" id="user-list-template">
        <div class="text-info">
            <h1>User Manager</h1>
        <hr />
        </div>
        <a href="#/new" class="btn btn-primary"><i class="glyphicon glyphicon-user"></i>&nbsp;New User</a>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Age</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <% _.each(users,function(user){ %>
                    <tr class="info">
                        <td><%= user.get('Fname') %></td>
                        <td><%= user.get('Lname') %></td>
                        <td><%= user.get('Age') %></td>
                        <td><a href="#/edit/<%= user.id%>" class="btn btn-warning"><i class="glyphicon glyphicon-pencil"></i>&nbsp;   Edit</a></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </script>
        
    <script type="text/template" id="edit-user-template">
        <form class="edit-user-form form-horizontal">
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10 h2 text-info"><%= user ? 'Update ' : 'Create '%>User</div>
            </div>
            <div class="form-group">
                <label for="Fname" class="col-sm-2 control-label">First Name</label>
                <div class="col-sm-10">
                    <input type="text" id="Fname" name="Fname" value="<%= user ? user.attributes.userInfo[0].Fname : '' %>" placeholder="Name...">
                </div>
            </div>
            <div class="form-group">
                <label for="Lname" class="col-sm-2 control-label">Last Name</label>
                <div class="col-sm-10">
                    <input type="text" id="Lname" name="Lname" value="<%= user ? user.attributes.userInfo[0].Lname : '' %>" placeholder="Last Name...">
                </div>
            </div>
            <div class="form-group">
                <label for="Age" class="col-sm-2 control-label">Age</label>
                <div class="col-sm-10">
                    <input type="text" id="Age" name="Age" value="<%= user ? user.attributes.userInfo[0].Age : '' %>" placeholder="Age...">
                </div>
            </div>
            <div class="form-group">
                <label for="role" class="col-sm-2 control-label">Role</label>
                <div class="col-sm-2">
                    <select class="form-control" id="role" name="role">
                        <% _.each(user.attributes.roles, function(info){ %>
                            <% if(user.attributes.userInfo[0].role == info){ %>
                                <option selected><%= info%></option>
                            <% }else{ %>
                                <option><%= info%></option>
                            <% } %>
                        <% });%>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-success"><i class="glyphicon glyphicon-user"><%= user ? 'Update ' : 'Create '%></i></button>
                    <% if(user) {%>
                    <input type="hidden" name="id" value="<%= user.id %>">
                    <button class="btn btn-danger delete" ><i class="glyphicon glyphicon-remove"></i>&nbsp;Delete</button>
                    <% }; %>
                </div>
            </div>
        </form>
    </script>

    <script type="text/template" id="subscribe-email">
        <form class="subscribe-email">
            <div class="pull-right">
                <input type="text" placeholder="Enter your email..." id="emailField" >
                <button class="btn btn-danger pull-right" type="submit" id="subscrb" style="padding:2px">Subscribe</button>
                <% if(email) {%>
                    <% if(email.attributes.error) {%>
                        <div>
                            <button class="btn btn-primary btn-block confirm" type="button">Unsubscribe from newsletter</button>
                        </div>
                    <% }; %>
                    <% if(email.attributes.msg) {%>
                        <div class="alert alert-block alert-success" style="font-size:11px">
                            <%= email.attributes.msg %>
                            <a class="close" data-dismiss="alert" href="#" onclick="$(this).parent().addClass('hide')">
                                <i class="glyphicon glyphicon-remove"></i>
                            </a>
                        </div>
                    <% }; %>
                <% }; %>
                <% if (error){%>
                    <div class="alert alert-danger">
                        <%= error %>
                        <a href="#"  onclick="$(this).parent().addClass('hide')">
                            <i class="glyphicon glyphicon-remove"></i>
                        </a>
                    </div>
                <% };%>
            </div>
        </form>
    </script>

    <script type="text/template" id="login-template">
        <div class="text-center vcenter">
            <form id="login">
                <% if(login) {%>
                    <% if(login.attributes.error) {%>
                    <div class="row">
                        <div class="col-md-4 col-md-offset-4">
                            <div class="alert alert-block alert-danger">
                                <a class="close" data-dismiss="alert" href="#" onclick="$(this).parent().parent().parent().addClass('hide')">X</a>
                                Incorrect Login or Password
                            </div>
                        </div>
                    </div>
                    <% };%>
                <% }; %>
                 <div class="form-group margin-left-30">
                    <label for="userName">Login</label>
                    <input type="text" name="userName" id="userName" placeholder="Login...">
                 </div>
                 <div class="form-group">
                    <label for="userPass">Password</label>
                    <input type="text" name="userPass" id="userPass" placeholder="Password...">
                 </div>
                 <div class="form-group">
                    <button class="btn btn-primary" id="loginBtn">Log In</button>
                 </div>
                <input type="hidden" name="operation" value="login">
            </form>
        </div>
    </script>

    <div class="navbar navbar-inverse navbar-fixed-bottom">
        <div class="container footer ">
            <div class="row">
                <div class="col-md-4">
                    <div class="navbar-text pull-left">Володимир Шалата <br>2015<br>Всі права захищені</div>
                </div>
                <div class="col-md-4  ">
                    <div class="navbar-text">Join us on <br>
                        Facebook    <a class="btn btn-xs btn-social-icon btn-facebook"> <i class="fa fa-facebook"></i></a>
                        Twitter    <a class="btn btn-xs btn-social-icon btn-twitter"> <i class="fa fa-twitter"></i></a>
                        VK<a class="btn btn-xs btn-social-icon btn-vk"> <i class="fa fa-vk"></i></a>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="pull-right email_subscription" style="padding-top:10px"></div>
                </div>
            </div>
        </div>
    </div>

    <script>

        var Emails = Backbone.Model.extend({
            url: '/www/Backbone/email.php',

            validate_email: function(){
                var errors = {};
                var emailVal = $("#emailField").val();
                var valid_email = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
                if(!emailVal.match(valid_email)){
                    errors = {error: "Please, enter the valid email", email: emailVal};
                }else{
                    errors = {error: "", email: emailVal};
                }
                return errors;
            }
        });
            
        var Users = Backbone.Collection.extend({
           url: '/www/Backbone/users.php'
        });
            
        var User = Backbone.Model.extend({
            urlRoot: '/www/Backbone/users.php'
        });

        var Home = Backbone.Model.extend({
            urlRoot: '/www/Backbone/home.php'
        });

        var UserLogin = Backbone.Model.extend({
            urlRoot: '/www/Backbone/login.php'
        });

        var Registration = Backbone.Model.extend({
            urlRoot: '/www/Backbone/registration.php'
        });

        var SessionModel = Backbone.Model.extend({
            defaults:{
                'user_id': null,
                'is_logged': false,
                'user_name': null,
                'user_role': null
            },
            initialize: function(){
                this.load();
            },
            load: function(){
                this.user_id = $.cookie('user_id');
                this.is_logged = $.cookie('is_logged');
                this.user_name = $.cookie('user_id');
                this.user_role = $.cookie('user_role');
            },
            save: function(name, value){
                switch(name){
                    /// Session not working correctle because didn`t put break after case statement
                    case 'user_id'  :{$.cookie('user_id', value);break;}
                    case 'is_logged':{$.cookie('is_logged', true);break;}
                    case 'user_name':{$.cookie('user_name', value);break;}
                    case 'user_role':{$.cookie('user_role', value);break;}
                }
            },
            get: function(name){
                return $.cookie(name);
            },
            remove: function(name){
               return  $.removeCookie(name);
            }


        });

        //Here defined View
        var UserList = Backbone.View.extend({
           el: '.page',
           render: function(){
               var self = this;
               var users = new Users();
               var session = new SessionModel();
               //Check if user logged in
               if(!session.get('is_logged')){
                   router.navigate('login',{trigger:true});
                   if(session.get('role') != 'owner'){
                       router.navigate('home', {trigger:true});
                   }
               }else{
                   users.fetch({success:function(users){
                       var template = _.template($('#user-list-template').html());
                       self.$el.html(template({'users': users.models}));
                   }});
               }
           }
        });


        var SignUp = Backbone.View.extend({
            el:'.page',
            render: function(){
                var template = _.template($("#sign-up").html());
                this.$el.html(template({}));

            },
            events:{
                'click #register': 'register'
            },
            register: function(ev){
                ev.preventDefault();
                var registerData = {};
                var formData = $("[name = 'sign_up']").find(":input");
                formData.each(function(){
                    registerData[$(this).attr('name')] = $(this).val();
                });
                var registr = new Registration();
                registr.save(registerData,{success: function(){
                    alert(1);
                }});
            }

        });

        var EditUser = Backbone.View.extend({
            el: '.page',

            render: function(option){
                var that = this;
                if(option.id){
                    that.user = new User({id : option.id});
                    that.user.fetch({
                    success:function(user){
                        var template = _.template($("#edit-user-template").html());
                        that.$el.html(template({user: user}));
                    }});
                }else{

                    //todo ERROR WHEN CREATE NEW USER, IN SELECT LIST
                    var template = _.template($('#edit-user-template').html());
                    that.$el.html(template({user: null}));
                 }
            },

            events:{
                'submit .edit-user-form': 'saveUser',
                'click .delete': 'deleteUser'
             },

            saveUser: function(ev){
                var userDetails = $(ev.currentTarget).serializeObject();
                var user = new User();
                user.save(userDetails,{success: function(){
                    router.navigate('userManager',{trigger:true});
                },
                    error: function(e){console.log(e);}
                });
                    return false;
                },
            deleteUser:function(ev){
                this.user.destroy({
                success: function(){
                    router.navigate('userManager',{trigger:true});
                }})
                return false;
            },wait:true
            });

        var SubscrEmail = Backbone.View.extend({
            el: ' .email_subscription',
            render: function(email, error){
                    if(email != null && typeof error != undefined){
                        var template = _.template($("#subscribe-email").html());
                        if(typeof email.attributes.error != undefined ){
                            this.$el.html(template({email: email, error:null}));

                            //confirm button
                            var el = $(".confirm");

                            var confEmail = new Emails();
                            $(".confirm").click(function(){
                                BootstrapDialog.confirm({
                                    type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
                                    title: 'Unsubscribing',
                                    message: 'Do you want to unsubscribe from newsletter?',
                                    closable: true, // <-- Default value is false
                                    draggable: true, // <-- Default value is false
                                    btnOKLabel: 'Yes', // <-- Default value is 'OK',
                                    btnCancelLabel: 'No', // <-- Default value is 'Cancel',
                                    btnOKClass: 'btn-warning',
                                    callback: function(result) {
                                        // result will be true if button was click, while it will be false if users close the dialog directly.
                                        if(result) {
                                            confEmail.save({email :email.attributes.email, operation: 'unsubscr'},{success:function(data){
                                                if(data.attributes.unsubscr){
                                                    BootstrapDialog.show({
                                                        type: this.TYPE_SUCCESS,
                                                        title: 'Unsubscribing confirmation',
                                                        message: 'You are successfully unsubscribed from the newsletter!',
                                                        buttons: [{
                                                            id: 'btn-ok',
                                                            label: 'OK',
                                                            cssClass: 'btn-success',
                                                            autospin: false,
                                                            action: function(dialogRef){
                                                                dialogRef.close();
                                                            }
                                                        }]
                                                    });
                                                }else{
                                                    BootstrapDialog.show({
                                                        type: this.TYPE_WARNING,
                                                        title: 'Error!',
                                                        message: 'Error... Please, try again later'
                                                    });
                                                }
                                                el.addClass('hide');
                                            }});
                                        }else {
                                            el.addClass('hide');
                                        }
                                    }
                                });
                            });
                        }
                    }else{
                        // render by default
                        var template = _.template($("#subscribe-email").html());
                        this.$el.html(template({email: null, error:null}));
                    }
                //render in case email is not valid
                    if(error){
                        var template = _.template($("#subscribe-email").html());
                        this.$el.html(template({email:null,error: error}));
                    }
            },

            events:{
                'submit .subscribe-email': 'addEmail'
            },

            addEmail: function(){
                var that = this;
                var email = new Emails();
                var errors = email.validate_email();
                if(errors.error =='' && errors.email){
                    email.save({'email': errors.email, operation: 'addEmail'}, {success:function(email){
                        that.render(email);
                    }});
                }else{
                    that.render(null,errors.error);
                }
                return false;
            }
        });

        var HomePage = Backbone.View.extend({
            el: '.page',
            render: function(){
                var session = new SessionModel();
                var megaMenu = new MenuView();
                var userName = session.get('user_name');
                var is_logged = session.get('is_logged');
                var home = new Home();
                var that = this;
                home.fetch({
                    success: function(data){
                        if(is_logged && userName){
                            data.userName = userName;
                        }
                        var template= _.template($("#home-page").html());
                        that.$el.html(template({data: data}));
                }});
                megaMenu.render();
            }
        });

        var LoginView = Backbone.View.extend({
            el: '.page',

            events:{
                'click #loginBtn': 'login_press'
            },

            render: function(loginData){
                var userLogin = new UserLogin();
                var that = this;
                var session = new SessionModel();
                var homePage = new HomePage();
                if(session.get('is_logged')){
                    var params = {};
                    params.is_logged = session.get('is_logged') || null;
                    params.user_name = session.get('user_name') || null;
                    homePage.render(params);
                }

                if(loginData){
                    var menu = new MenuView();
                    userLogin.save(loginData,
                        {success: function(data){
                            var template = _.template($("#login-template").html());
                            that.$el.html(template({login: data}));
                            if(data.attributes.error == ""){
                                session.save('user_id', data.attributes.id);
                                session.save('is_logged', data.attributes.is_loged_in);
                                session.save('user_role', data.attributes.role);
                                session.save('user_name', data.attributes.userName);
//                                console.log(session);
                                menu.render(data.attributes.is_loged_in, data.attributes.role);
                                switch(data.attributes.role){
                                    case "admin": {
                                        router.navigate('userManager', {trigger:true});
                                        break;
                                    };
                                    case "owner": {
                                        router.navigate('userManager', {trigger:true});
                                        break;
                                    };
                                    case "user": {
                                        router.navigate('home', {trigger:true});
                                    };
                                }
                            }else{
                                /// todo handle errors
                                menu.render(null);
                            }
                        }}
                    )
                }else{
                    var template = _.template($("#login-template").html());
                    that.$el.html(template({login: null}));
                }

            },

            login_press: function(e){
                e.preventDefault();
                var loginData = $("#login").serializeObject();
                if(loginData.length !=0){
                    this.render(loginData);
                }
            }

        });

        ///todo write render for handle login megamenu
        var MenuView = Backbone.View.extend({
            el: '.mega_menu',

            render: function(is_logged, role){
                var menuInfo = {};
                var session = new SessionModel();
                if(session.get('is_logged') && session.get('user_role')) {
                    menuInfo.is_logged = session.get('is_logged');
                    menuInfo.role = session.get('user_role');
//                    console.log(menuInfo);
                    var template = _.template($("#mega-menu").html());
                    this.$el.html(template({menuInfo: menuInfo}));
                }else{
                    var template = _.template($("#mega-menu").html());
                    this.$el.html(template({menuInfo: null}));
                }
            }
        });

        var LogoutView = Backbone.View.extend({
            render : function(){
                var megaMenu = new MenuView();
                var session = new SessionModel();
                session.remove('is_logged');
                session.remove('user_role');
                session.remove('user_name');
                session.remove('user_id');
                router.navigate('login', {trigger:true});
                var template = _.template($("#mega-menu").html());
                this.$el.html(template({menuInfo: null}));
                megaMenu.render();
            }
        });
        ///
            
        //Define Backbone router obj
        var Router = Backbone.Router.extend({
            routes:{
                //'' - means home directory
                'home': 'home',
                'userManager': 'userManager',
                'new': 'editUser',
                'edit/:id': 'editUser',
                'login' : 'login',
                'logout': 'logout',
                'signup': 'signup'
            }
        });

        //Defining main objects
        var router = new Router();
        var session = new SessionModel();
        var userList = new UserList();
        var editUser = new EditUser();
        var subscrEmail = new SubscrEmail();
        var homePage = new HomePage();
        var login = new LoginView();
        var logOut = new LogoutView();
        var menuView = new MenuView();
        var signUp = new SignUp();

        //Session variables
        var logIn = session.get('is_logged');
        var role = session.get('user_role');

        if(!logIn && !role){
            router.navigate('login', {trigger:true});
        }
        //Always render email and Menu View
        subscrEmail.render();
        menuView.render();


        router.on('route:userManager',function(){
            //when we go to the home directory, backbone router see that its calles home
            //and bind it with this event, in witch we launch render function to the userlist object
            //that defined in userLIst object, and insert data into the template
            userList.render();
        });
        router.on('route:editUser',function(id){
            editUser.render({id: id});
        });
        router.on('route:home', function(){
            homePage.render();
        });
        router.on('route:login', function(){
            login.render();
        });
        router.on('route:logout', function(){
            logOut.render();
        });
        router.on('route:signup', function(){
            signUp.render();
        });
        Backbone.history.start();

        </script>

    </body>
    
</html>
